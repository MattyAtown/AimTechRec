<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AiMTechRec | Job Board</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #0ff;
    }
    header {
      background: #111;
      text-align: center;
      padding: 20px;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 0 0 20px #0ff;
    }
    .container {
      display: flex;
      justify-content: space-between;
      padding: 20px;
      gap: 20px;
    }
    .panel {
      flex: 1;
      background: #111;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px #0ff;
      min-height: 600px;
      overflow-y: auto;
    }
    .panel h2 {
      font-size: 22px;
      color: #0ff;
      border-bottom: 2px solid #0ff;
      padding-bottom: 5px;
    }
    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .filter-bar input,
    .filter-bar select {
      padding: 8px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #0ff;
      background: #222;
      color: #0ff;
    }
    .job-card {
      border: 1px solid #0ff;
      border-radius: 5px;
      margin-bottom: 10px;
      padding: 10px;
      background: #1a1a1a;
    }
    .score-box {
      font-size: 12px;
      color: #fff;
      margin-top: 5px;
    }
    button {
      background: #0ff;
      color: #000;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #0cc;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    Welcome to AiMTechRec | The Future of Recruitment
  </header>
  <div class="container">
    <!-- Panel 1: Live Listings -->
    <div class="panel">
      <h2>Live Job Listings</h2>
      <div class="filter-bar">
        <input type="text" id="job-title" placeholder="Job title" />
        <input type="text" id="location" placeholder="Location" />
        <input type="number" id="min-salary" placeholder="Min Salary" />
        <input type="number" id="max-salary" placeholder="Max Salary" />
        <select id="work-type">
          <option value="">Work Type</option>
          <option value="remote">Remote</option>
          <option value="hybrid">Hybrid</option>
          <option value="onsite">On-site</option>
        </select>
        <select id="industry">
          <option value="">Industry</option>
          <option value="tech">Tech</option>
          <option value="finance">Finance</option>
          <option value="health">Healthcare</option>
        </select>
        <button onclick="fetchLiveJobs()">Search</button>
      </div>
      <div id="live-jobs-container">Loading jobs...</div>
    </div>

    <!-- Panel 2: Smart AI Matches -->
    <div class="panel">
      <h2>Jobs You Should Apply For</h2>
      <div id="smart-matches-container">Analyzing CV data...</div>
    </div>
  </div>

  <script>
    async function fetchLiveJobs() {
      const title = document.getElementById('job-title').value;
      const location = document.getElementById('location').value;
      const minSalary = document.getElementById('min-salary').value;
      const maxSalary = document.getElementById('max-salary').value;
      const workType = document.getElementById('work-type').value;
      const industry = document.getElementById('industry').value;

      const query = new URLSearchParams({ title, location, minSalary, maxSalary, workType, industry });
      const res = await fetch(`/api/live_jobs?${query.toString()}`);
      const jobs = await res.json();

      const container = document.getElementById('live-jobs-container');
      if (!Array.isArray(jobs) || jobs.length === 0) {
        container.innerHTML = '<p>No results found. Try adjusting your filters.</p>';
        return;
      }
      container.innerHTML = jobs.map(job => `
        <div class="job-card">
          <strong>${job.title}</strong><br/>
          ${job.location} - ${job.salary}
        </div>
      `).join('');
    }

    async function fetchSmartMatches() {
      const res = await fetch('/api/smart_matches');
      const matches = await res.json();
      const container = document.getElementById('smart-matches-container');
      if (!Array.isArray(matches) || matches.length === 0) {
        container.innerHTML = '<p>No tailored matches found. Please upload your CV for smart matching.</p>';
        return;
      }
      container.innerHTML = matches.map(match => `
        <div class="job-card">
          <strong>${match.title}</strong><br/>
          ${match.location} - ${match.salary}
          <div class="score-box">
            Skill Match: ${match.skill_match}%<br/>
            Interview Probability: ${match.interview_prob}%<br/>
            Suitability Score: ${match.suitability}%
          </div>
        </div>
      `).join('');
    }

    fetchLiveJobs();
    fetchSmartMatches();
  </script>
</body>
</html>
