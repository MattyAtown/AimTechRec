<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AiMTechRec | Job Board</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
  <header>
    Welcome to AiMTechRec | The Future of Recruitment
  </header>
  <div id="quote-banner">
    "The job you seek might just be seeking you â€“ let AiM show you the way."
  </div>
  <div class="container">
    <!-- Panel 1: Live Listings -->
    <div class="panel">
      <h2>Live Job Listings</h2>
      <div class="filter-bar">
        <input type="text" id="job-title" placeholder="Job title" />
        <input type="text" id="location" placeholder="Location" />
        <input type="number" id="min-salary" placeholder="Min Salary" />
        <input type="number" id="max-salary" placeholder="Max Salary" />
        <select id="work-type">
          <option value="">Work Type</option>
          <option value="remote">Remote</option>
          <option value="hybrid">Hybrid</option>
          <option value="onsite">On-site</option>
        </select>
        <select id="industry">
          <option value="">Industry</option>
          <option value="tech">Tech</option>
          <option value="finance">Finance</option>
          <option value="health">Healthcare</option>
        </select>
        <button onclick="fetchLiveJobs()">Search</button>
      </div>
      <div id="live-jobs-container">Loading jobs...</div>
    </div>

    <!-- Panel 2: Smart AI Matches -->
    <div class="panel">
      <h2>Jobs You Should Apply For</h2>
      <div id="smart-matches-container"></div>
    </div>
  </div>

  <script>
    async function fetchLiveJobs() {
      const title = document.getElementById('job-title').value;
      const location = document.getElementById('location').value;
      const minSalary = document.getElementById('min-salary').value;
      const maxSalary = document.getElementById('max-salary').value;
      const workType = document.getElementById('work-type').value;
      const industry = document.getElementById('industry').value;

      const query = new URLSearchParams({ title, location, minSalary, maxSalary, workType, industry });
      const res = await fetch(`/api/live_jobs?${query.toString()}`);
      const jobs = await res.json();

      const container = document.getElementById('live-jobs-container');
      if (!Array.isArray(jobs) || jobs.length === 0) {
        container.innerHTML = '<p>No results found. Try adjusting your filters.</p>';
        return;
      }
      container.innerHTML = jobs.map(job => `
        <div class="job-card">
          <strong>${job.title}</strong><br/>
          ${job.location} - ${job.salary}<br/>
          <a href="${job.link}" target="_blank">View Job</a>
        </div>
      `).join('');
    }

    async function fetchSmartMatches() {
      const res = await fetch('/api/smart_matches');
      const matches = await res.json();
      const container = document.getElementById('smart-matches-container');
      if (!Array.isArray(matches) || matches.length === 0) {
        container.innerHTML = '<p>No tailored matches found. Please upload your CV for smart matching.</p>';
        return;
      }
      container.innerHTML = matches.map(match => {
        if (!match.from_cv_match) return ''; // Only display matches linked to CV
        return `
          <div class="job-card">
            <strong>${match.title}</strong><br/>
            ${match.location} - ${match.salary}
            <div class="score-box">
              Skill Match: ${match.skill_match}%<br/>
              Interview Probability: ${match.interview_prob}%<br/>
              Suitability Score: ${match.suitability}%
            </div>
          </div>
        `;
      }).join('');
    }

    fetchLiveJobs();
    fetchSmartMatches();
  </script>
</body>
</html>
v
